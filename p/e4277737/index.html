<!DOCTYPE html><html><head><meta charset="utf-8"><title>Don&#39;t Repeat Yourself | 曹耘豪的博客</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="alternate" href="/atom.xml" title="曹耘豪的博客" type="application/atom+xml"><link rel="icon" href="https://s1.ax1x.com/2018/06/09/CbgQqs.png"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="header2" style="border-bottom:1px solid #ccc"><input type="checkbox" id="header-menu-input"><h1 style="text-align:left"><a href="/">曹耘豪的博客</a> <label for="header-menu-input"><svg class="op open" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 50 50" fill="currentcolor" stroke="currentcolor"><path d="M 0 7.5 L 0 12.5 L 50 12.5 L 50 7.5 Z M 0 22.5 L 0 27.5 L 50 27.5 L 50 22.5 Z M 0 37.5 L 0 42.5 L 50 42.5 L 50 37.5 Z"></path></svg> <svg class="close" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 30 30" style="fill:red"><path d="M 7 4 C 6.744125 4 6.4879687 4.0974687 6.2929688 4.2929688 L 4.2929688 6.2929688 C 3.9019687 6.6839688 3.9019687 7.3170313 4.2929688 7.7070312 L 11.585938 15 L 4.2929688 22.292969 C 3.9019687 22.683969 3.9019687 23.317031 4.2929688 23.707031 L 6.2929688 25.707031 C 6.6839688 26.098031 7.3170313 26.098031 7.7070312 25.707031 L 15 18.414062 L 22.292969 25.707031 C 22.682969 26.098031 23.317031 26.098031 23.707031 25.707031 L 25.707031 23.707031 C 26.098031 23.316031 26.098031 22.682969 25.707031 22.292969 L 18.414062 15 L 25.707031 7.7070312 C 26.098031 7.3170312 26.098031 6.6829688 25.707031 6.2929688 L 23.707031 4.2929688 C 23.316031 3.9019687 22.682969 3.9019687 22.292969 4.2929688 L 15 11.585938 L 7.7070312 4.2929688 C 7.5115312 4.0974687 7.255875 4 7 4 z"></path></svg></label> <input disabled id="local-search-input" class="input-text" type="search" placeholder="js未开启，无法搜索" aria-label="Search"></h1><div id="local-search-result"></div><div class="header-menu" for="header-menu-input"><aside id="sidebar"><div><div class="widget-wrap widget-category"><h3 class="widget-title">目录</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/category/other/">其他</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/">技术</a><span class="category-list-count">137</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/category/technology/cpp/">C++</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/Go/">Go</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/java/">Java</a><span class="category-list-count">59</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/python/">Python</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/Rust/">Rust</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/machine-learning/">机器学习</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/computer-network/">计算机网络</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/design-pattern/">设计模式</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/%E8%AF%B4%E8%AF%B4/">说说</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/category/technology/%E8%BF%90%E7%BB%B4/">运维</a><span class="category-list-count">13</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/category/algorithm/">算法</a><span class="category-list-count">8</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">标签</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">MySQL</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Protobuf/" rel="tag">Protobuf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/" rel="tag">Spring Cloud</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Feign/" rel="tag">Feign</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag">问题排查</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nextjs/" rel="tag">Nextjs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">Spring</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/" rel="tag">JVM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">代理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/" rel="tag">Gradle</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/" rel="tag">Maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fastjson/" rel="tag">fastjson</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%93%E5%AD%98/" rel="tag">缓存</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/" rel="tag">Hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HBase/" rel="tag">HBase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/" rel="tag">响应式编程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">其他</h3><div class="widget"><a href="/atom.xml">RSS Feed </a><a href="/resume" style="margin-left:8px">Resume</a></div></div></div></aside></div><script src="/js/search.js"></script><script type="text/javascript">(()=>{var e="local-search-input",a=(($input=document.getElementById(e)).disabled=!1,$input.placeholder="全站本地搜索","search.json"),a="/"+(a=0===a.length?"search.json":a);searchFunc(a,e,"local-search-result")})()</script></div><article id="post-e4277737" class="article article-type-post" itemscope itemprop="blogPost" style="position:relative"><header><h1 class="article-title" itemprop="name">Don&#39;t Repeat Yourself</h1></header><div class="secondary-bg" style="border:1px solid gray;border-radius:4px"><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%88%9D%E8%A7%81%E7%AB%AF%E5%80%AA"><span class="toc-nav-text">初见端倪</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%96%B9%E6%B3%95%E7%9A%84DRY"><span class="toc-nav-text">方法的DRY</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84DRY"><span class="toc-nav-text">变量的DRY</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%B1%BB%E7%9A%84DRY"><span class="toc-nav-text">类的DRY</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%8A%9F%E8%83%BD%E7%9A%84DRY%E2%80%94%E2%80%94%E7%BB%84%E4%BB%B6%E5%8C%96%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E3%80%81DDD%E3%80%81%E6%A1%86%E6%9E%B6%E5%8C%96"><span class="toc-nav-text">功能的DRY——组件化、微服务、DDD、框架化</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%9A%84DRY%E2%80%94%E2%80%94%E5%B9%B3%E5%8F%B0%E5%8C%96"><span class="toc-nav-text">服务的DRY——平台化</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%A8%8B%E5%BA%8F%E7%9A%84DRY"><span class="toc-nav-text">程序的DRY</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4DRY%E2%80%94%E2%80%94%E5%BC%80%E5%8F%91%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7"><span class="toc-nav-text">日常运维DRY——开发自动化运维工具</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#DRY%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="toc-nav-text">DRY的一些问题</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%94%9F%E6%B4%BB%E4%B8%8A%E7%9A%84DRY"><span class="toc-nav-text">生活上的DRY</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-nav-text">总结</span></a></li></ol></div><h3 id="初见端倪"><a href="#初见端倪" class="headerlink" title="初见端倪"></a>初见端倪</h3><p>DRY，第一次看到这个词，是在《程序员修炼之道》里，一本在大学时就听说的书，但一直没有读，直到工作两年再次拾起，仿佛遇到故友。</p><h3 id="方法的DRY"><a href="#方法的DRY" class="headerlink" title="方法的DRY"></a>方法的DRY</h3><p>事实上，从大一开始的时候我就一直执行DRY原则，那个时候学习面向过程（C语言）。因为我很懒，所以有的代码不想写两边，便抽成一个公共函数。</p><h3 id="变量的DRY"><a href="#变量的DRY" class="headerlink" title="变量的DRY"></a>变量的DRY</h3><p>直到毕业，我还会看到有的同学会写出下面的代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isValid(getFromDB())) &#123;</span><br><span class="line">    process(getFromDB())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>显然，查询了2次数据库，这是没有必要的。更好的写法应该是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">dbValue</span> <span class="operator">=</span> getFromDB()</span><br><span class="line"><span class="keyword">if</span> (isValid(dbValue)) &#123;</span><br><span class="line">    process(dbValue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以前我也认为这很简单，事实上还是有很多人做不到。</p><p>复用变量可以说是复用的最小粒度。</p><p>有时候，我们也可以使用懒加载工具来更好的控制非必要执行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Lazy&lt;Object&gt; dbValueLazy = Lazy.of(() -&gt; getFromDB())</span><br><span class="line"><span class="keyword">if</span> (otherCondition &amp;&amp; isValid(dbValue.get())) &#123;</span><br><span class="line">    process(dbValue.get())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者下面写法，jdk内部很多地方用到该写法</span></span><br><span class="line">Object dbValue;</span><br><span class="line"><span class="keyword">if</span> (otherCondition &amp;&amp; isValid(dbValue = getFromDB())) &#123;</span><br><span class="line">    process(dbValue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际工作中，我还没见过有人这么写。</p><h3 id="类的DRY"><a href="#类的DRY" class="headerlink" title="类的DRY"></a>类的DRY</h3><p>模板方法设计模式非常直观执行DRY原则，比如我们常用的继承。</p><h3 id="功能的DRY——组件化、微服务、DDD、框架化"><a href="#功能的DRY——组件化、微服务、DDD、框架化" class="headerlink" title="功能的DRY——组件化、微服务、DDD、框架化"></a>功能的DRY——组件化、微服务、DDD、框架化</h3><p>一个功能可以是一个方法，比如一个工具方法，也可以是一个类或一组类。在Spring里，可以是一套Controller、Service、Repository的组合，提供一套能力，看起来更像是一个领域（domain）。</p><p>原则上，能力越抽象，可复用性就会越强，但过度抽象也会导致代码复杂度的提升和可读性的降低。</p><p>我认为，理想的项目应该存在<strong>大量的开箱即用的工具</strong>，这些工具可以降低业务代码量。</p><p>比如下面一段非常常见的代码：判断不合法然后抛出异常。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!isValid(value)) &#123;</span><br><span class="line">    <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;invalid value: &quot;</span> + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我们封装了工具方法，我们在业务代码里只需1行即可。函数实现参考了guava。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">checkArgument(isValid(value), <span class="string">&quot;invalid value: %s&quot;</span>, value)</span><br><span class="line"></span><br><span class="line"><span class="comment">// checkArgument实现</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">checkArgument</span><span class="params">(<span class="type">boolean</span> b, String messageTemplate, Object ...args)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123;</span><br><span class="line">        <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(format(messageTemplate, args))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这种做法还统一了抛出异常的类型，更重要的是隐藏了抛出的具体异常实现，<strong>仅表达了我们的目的</strong>：校验参数，至于以后抛出的是BusinessException还是IllegalArgumentException，仅需改一个地方即可。</p><p>对于上面抛出的异常，Spring可以使用统一的全局异常处理器和<code>ResponseBodyAdvice</code>，但如果没有相关工具，我们每个Controller的代码可能是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> Response <span class="title function_">api</span><span class="params">(<span class="meta">@RequestBody</span> Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isValid(value)) &#123;</span><br><span class="line">            <span class="keyword">throws</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;invalid value: &quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// other code</span></span><br><span class="line">        <span class="keyword">return</span> Response.success();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (BusinessException e) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;warn log&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Response.fail(-<span class="number">1</span>, e.getMessage);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Excetion e) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;error log&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Response.fail(-<span class="number">2</span>, <span class="string">&quot;server error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果有，那么我们的业务代码更简单：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">api</span><span class="params">(<span class="meta">@RequestBody</span> Object value)</span> &#123;</span><br><span class="line">    checkArgument(isValid(value), <span class="string">&quot;invalid value: %s&quot;</span>, value);</span><br><span class="line">    <span class="comment">// other code</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在<strong>全局异常处理器</strong>中分别处理BusinessException异常和其他异常。</p><h3 id="服务的DRY——平台化"><a href="#服务的DRY——平台化" class="headerlink" title="服务的DRY——平台化"></a>服务的DRY——平台化</h3><p>在微服务架构里，我们希望我们的服务提供单一能力，但不是一蹴而就的。</p><p>当一个业务成熟后，我们也会希望把业务能力通用化、标准化、平台化。</p><p>比如之前做人群标签，项目初期仅考虑人群，项目成熟之后，我们后来会想做一个通用标签平台，不仅仅对于用户，我们提前约定好标签数据的格式。然后将之前的人群标签，按照新的平台标准格式接入到标签平台。</p><p>比如对于支付能力，在我们作完充值、购买后，我们希望支付能力是通用的，所以做了支付中台，隐藏每种支付渠道的实现，对外提供标准的下单、查询、回调等能力，然后将充值、购买都接入支付中台。</p><p>再比如各种云服务商、各种XaaS平台。</p><h3 id="程序的DRY"><a href="#程序的DRY" class="headerlink" title="程序的DRY"></a>程序的DRY</h3><p>java开始的口号便是“Write once, run anywhere”，也是一种DRY。</p><h3 id="日常运维DRY——开发自动化运维工具"><a href="#日常运维DRY——开发自动化运维工具" class="headerlink" title="日常运维DRY——开发自动化运维工具"></a>日常运维DRY——开发自动化运维工具</h3><p>现在，排查问题总免不了查询MySQL，使用查询工具Navicat、DataGrip等，但我们总是需要写很多重复的SQL，并且DB的结果并不直观，除非你记住表里的1、2、3分别代表什么。</p><p>为此，我在业余时间开发了一个查询工具网站，预设了一些我常用的表，以及每个表的筛选字段。也对一些表增加了跳转，比如一个表有user_id字段，增加一个链接，链接到对应的用户详情表。这样，以前需要写模板SQL的，现在只需要点点点即可。也可以在一个页面同时展示所有用户相关的表，一览无余。后来该工具在部门内做了推广，被评价“一个朴实而又不失优雅，简单而又不失自然的小工具”。</p><h3 id="DRY的一些问题"><a href="#DRY的一些问题" class="headerlink" title="DRY的一些问题"></a>DRY的一些问题</h3><ul><li><p><strong>失去灵活性</strong>。如果想在共用的程序里执行一些定制化逻辑，看起来会比较困难，并且破坏了封装原则（也或许证明当下是<strong>过度封装</strong>）。这种情况，应放弃DRY，或者应该使用更细粒度的DRY，避免过度封装</p></li><li><p><strong>性能损失</strong>。一个DRY模块内部或许是高效的，但模块之间的交互，比如函数调用、类的创建和销毁、微服务间的RPC调用，都会导致性能损失。但从系统维护成本、代码可读性、系统隔离等方面考虑，这种消耗<strong>通常</strong>是值得的。</p></li><li><p><strong>遏制创新</strong>。这是平台化后的问题，我认为也属于过渡封装。所有的接入方都要按照平台的要求接入，如果某项功能平台不支持，则没办法（可以给平台提需求，但排期不可控），或者使用一些比较trick的方法实现。<strong>我们在享受平台便利的同时，平台也在限制我们思考与创新。</strong></p></li></ul><h3 id="生活上的DRY"><a href="#生活上的DRY" class="headerlink" title="生活上的DRY"></a>生活上的DRY</h3><p>生活上，有时我们需要重复，比如学习一项技能、坚持读书健身，这些重复是有意义的。</p><p>但我们也能看到一些DRY的场景，比如一些大而全的APP、聚合网站等，尤其是聚合社交网络</p><p>比如我们要在社交网络上发表动态，有微博、X、知乎等很多平台，如果我们每个都发一边也是很麻烦，于是就有类似的聚合平台，关联上每个平台的账号，发一次即可同步到其他平台。</p><p>又比如现在的智能家居，开门自动化等操作，都是为了减少生活中的重复。</p><p>重复的生活也会对人的心理健康产生负面影响。</p><p>所以有一种说法便是，懒是社会进步的推动力，人会想办法让自己<strong>可以懒</strong>，因为我们想懒，所以我们必须创造各种工具，提高效率。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>无论我们写代码、还是系统设计、日常生活，DRY无处不在。时刻提醒自己，尽量不要重复你自己！</p><div style="border-top:2px solid #eee;height:1px;margin:8px 0"></div><div class="article-category"><svg class="i-tag" width="16px" height="16px" viewBox="0 0 24 24" fill="currentcolor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.41959 3.23866C6.23018 3.05852 7.19557 3 8.312 3H9.92963C10.9327 3 11.8694 3.5013 12.4258 4.3359L13.2383 5.5547C13.4238 5.83288 13.736 6 14.0704 6H19.1258C20.7233 6 22.0181 7.26115 22.0029 8.8852C21.9847 10.8192 22 12.7539 22 14.688C22 15.8044 21.9415 16.7698 21.7613 17.5804C21.5787 18.4024 21.2579 19.1251 20.6915 19.6915C20.1251 20.2579 19.4024 20.5787 18.5804 20.7613C17.7698 20.9415 16.8044 21 15.688 21H8.312C7.19557 21 6.23018 20.9415 5.41959 20.7613C4.59764 20.5787 3.87488 20.2579 3.30848 19.6915C2.74209 19.1251 2.42133 18.4024 2.23866 17.5804C2.05852 16.7698 2 15.8044 2 14.688V9.312C2 8.19557 2.05852 7.23018 2.23866 6.41959C2.42133 5.59764 2.74209 4.87488 3.30848 4.30848C3.87488 3.74209 4.59764 3.42133 5.41959 3.23866ZM8.19103 13.8535C8.05868 14.449 8 15.2412 8 16.312V18C8 18.5523 7.55228 19 7 19C6.44772 19 6 18.5523 6 18V16.312C6 15.1956 6.05852 14.2302 6.23866 13.4196C6.42133 12.5976 6.74209 11.8749 7.30848 11.3085C7.87488 10.7421 8.59764 10.4213 9.41959 10.2387C10.2302 10.0585 11.1956 10 12.312 10H17.688H19C19.5523 10 20 10.4477 20 11C20 11.5523 19.5523 12 19 12H17.688H12.312C11.2412 12 10.449 12.0587 9.85349 12.191C9.26933 12.3209 8.9375 12.5079 8.72269 12.7227C8.50789 12.9375 8.32085 13.2693 8.19103 13.8535Z"/></svg> &nbsp; <a class="article-category-link" href="/category/technology/">技术</a>&nbsp;/&nbsp;<a class="article-category-link" href="/category/technology/%E8%AF%B4%E8%AF%B4/">说说</a></div><div class="article-date"><time datetime="2025-02-28T01:00:00.000Z" itemprop="datePublished">2025-02-28</time></div></article></body></html>